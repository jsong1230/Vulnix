# F-07 대시보드 확장 — 테스트 결과 (RED 단계)

- 날짜: 2026-02-25
- 단계: Phase 1 RED (구현 전)
- 테스트 파일: `backend/tests/api/test_dashboard_extended_api.py`

---

## 실행 결과 요약

```
29 failed, 6 passed in 1.29s
```

| 구분 | 건수 | 의미 |
|------|------|------|
| FAILED | 29 | F-07 미구현 기능 — 구현 후 GREEN으로 전환되어야 함 |
| PASSED | 6 | 기존 F-04 구현이 이미 올바르게 동작 (회귀 보호용) |

---

## FAILED 테스트 목록 (구현 필요)

### I-07-01: GET /api/v1/dashboard/repo-scores (신규)

| 테스트명 | 실패 원인 |
|---------|---------|
| `test_repo_scores_returns_200_with_required_fields` | 엔드포인트 없음 → 404 |
| `test_repo_scores_sort_asc` | 엔드포인트 없음 → 404 |
| `test_repo_scores_sort_desc` | 엔드포인트 없음 → 404 |
| `test_repo_scores_requires_auth` | 엔드포인트 없음 → 404 (401이어야 함) |
| `test_repo_scores_empty_data_returns_200` | 엔드포인트 없음 → 404 |

### I-07-02: GET /api/v1/dashboard/team-scores (신규)

| 테스트명 | 실패 원인 |
|---------|---------|
| `test_team_scores_returns_200_with_required_fields` | 엔드포인트 없음 → 404 |
| `test_team_scores_empty_team_returns_zero_score` | 엔드포인트 없음 → 404 |
| `test_team_scores_requires_auth` | 엔드포인트 없음 → 404 (401이어야 함) |
| `test_team_scores_avg_score_calculation` | 엔드포인트 없음 → 404 |

### I-07-03: GET /api/v1/dashboard/trend (open_count 추가)

| 테스트명 | 실패 원인 |
|---------|---------|
| `test_trend_data_points_have_open_count_field` | `open_count` 필드 없음 |
| `test_trend_existing_fields_preserved` | `open_count` 필드 없음 |
| `test_trend_30_days_data_length` | `open_count` 필드 없음 |
| `test_trend_open_count_non_negative` | `open_count` 필드 없음 |

### I-07-04: GET /api/v1/dashboard/severity-distribution (신규)

| 테스트명 | 실패 원인 |
|---------|---------|
| `test_severity_distribution_returns_200_with_required_fields` | 엔드포인트 없음 → 404 |
| `test_severity_distribution_total_equals_sum` | 엔드포인트 없음 → 404 |
| `test_severity_distribution_repo_id_filter` | 엔드포인트 없음 → 404 |
| `test_severity_distribution_by_type_structure` | 엔드포인트 없음 → 404 |
| `test_severity_distribution_requires_auth` | 엔드포인트 없음 → 404 (401이어야 함) |

### I-07-05: GET /api/v1/vulnerabilities (vulnerability_type 필터)

| 테스트명 | 실패 원인 |
|---------|---------|
| `test_filter_by_vulnerability_type_is_applied` | `list_vulns_query`에 `vulnerability_type_filter` 파라미터 없음 |
| `test_vulnerability_type_filter_not_ignored` | `list_vulnerabilities`가 `vulnerability_type` 파라미터를 `list_vulns_query`에 전달 안 함 → total=5 (기대: 3) |
| `test_vulnerability_type_nonexistent_returns_empty` | 필터 미전달 → total != 0 |
| `test_vulnerability_type_combined_with_severity_filter` | `vulnerability_type_filter` 파라미터 미전달 |
| `test_vulnerability_type_preserves_existing_filters` | `vulnerability_type_filter` 파라미터 미전달 |

### I-07-06: GET /api/v1/dashboard/summary (avg_security_score 추가)

| 테스트명 | 실패 원인 |
|---------|---------|
| `test_summary_includes_avg_security_score` | `avg_security_score` 필드 없음 |
| `test_summary_avg_score_is_80_for_single_repo` | `avg_security_score` 필드 없음 |
| `test_summary_existing_fields_preserved_with_avg_score` | `avg_security_score` 필드 없음 |
| `test_summary_avg_score_zero_when_no_repos` | `avg_security_score` 필드 없음 |

### 경계 조건

| 테스트명 | 실패 원인 |
|---------|---------|
| `test_repo_scores_no_500_when_empty` | 엔드포인트 없음 → 404 |
| `test_repo_scores_security_score_null_treated_as_zero` | 엔드포인트 없음 → 404 |

---

## PASSED 테스트 목록 (기존 기능 회귀 보호)

| 테스트명 | 의미 |
|---------|------|
| `test_list_vulnerabilities_endpoint_accepts_vulnerability_type_param` | FastAPI가 알 수 없는 쿼리 파라미터를 무시하고 200 반환 — 기존 동작 확인 |
| `test_vuln_detail_has_patch_pr_field` | VulnerabilityResponse에 patch_pr 필드 이미 존재 (F-04 구현) |
| `test_vuln_detail_patch_pr_null_when_no_pr` | patch_pr=null 처리 이미 구현 (F-04 구현) |
| `test_trend_days_clamped_to_90` | days=90 클램핑 이미 구현 (F-04 구현) |
| `test_trend_days_zero_handled_gracefully` | days=0 시 200 반환 이미 구현 (F-04 구현) |
| `test_vulnerability_type_filter_sql_injection_attempt_blocked` | SQL 특수문자 포함 파라미터 처리 정상 동작 (보안 회귀) |

---

## 구현 에이전트 작업 목록

### backend-dev 작업 필요 파일

| 파일 | 변경 내용 |
|------|---------|
| `backend/src/api/v1/dashboard.py` | `repo-scores`, `team-scores`, `severity-distribution` 엔드포인트 추가. `trend`에 `open_count` 추가. `summary`에 `avg_security_score` 추가. |
| `backend/src/schemas/dashboard.py` | `RepoScore`, `TeamScore`, `SeverityDistribution` 스키마 추가. `TrendDataPoint`에 `open_count` 추가. `DashboardSummary`에 `avg_security_score` 추가. |
| `backend/src/api/v1/vulns.py` | `list_vulnerabilities`에 `vulnerability_type` 쿼리 파라미터 추가. `list_vulns_query`에 `vulnerability_type_filter` 파라미터 추가. |

---

## 인수조건 매핑

| 인수조건 | 관련 테스트 | 상태 |
|---------|-----------|------|
| AC-07-01: 저장소별 보안 점수 표시 | I-07-01-A~E, I-07-06-A~D | RED (FAIL) |
| AC-07-02: 팀별 보안 점수 집계 표시 | I-07-02-A~C | RED (FAIL) |
| AC-07-03: 취약점 추이 그래프 (신규/해결/미해결) | I-07-03-A~D | RED (FAIL) |
| AC-07-04: 심각도별 취약점 분포 차트 | I-07-04-A~E | RED (FAIL) |
| AC-07-05: 취약점 필터링 (저장소, 심각도, 상태, 유형) | I-07-05-A~E | RED (FAIL) |
| AC-07-06: 취약점 상세에서 패치 PR 링크 이동 | I-07-07-A~B | GREEN (기존 구현) |

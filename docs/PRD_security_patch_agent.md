# PRD: AI 보안 코드 취약점 탐지 + 자동 패치 에이전트

**문서 버전**: v0.1 (초안)
**작성일**: 2026년 2월
**상태**: 검토 중

---

## 1. 개요 (Overview)

### 1-1. 한 줄 정의

> 코드 저장소를 연동하면, AI가 보안 취약점을 찾아 **직접 패치 PR까지 만들어주는** 개발자용 보안 에이전트 SaaS.

### 1-2. 배경 및 기회

기존 SAST(정적 분석) 도구 시장은 Veracode, Checkmarx, Fortify가 과점하고 있으며 연 수천만~수억원의 라이선스 구조로 운영된다. 이 도구들의 결정적 한계는 두 가지다.

첫째, 취약점을 **발견**만 하고 **수정 방법은 제공하지 않는다**. 보안팀이 개발팀에 전달하고, 개발팀은 다시 컨설턴트에게 묻는 3단계 비효율이 발생한다. 둘째, 오탐(false positive)이 전체 알림의 30~60%에 달해 개발자들이 알람을 무시하게 된다.

LLM의 코드 이해 수준이 시니어 개발자급에 도달한 지금, 탐지와 패치를 하나의 에이전트로 묶을 수 있다. Snyk이 탐지+의존성 관리로 유니콘이 됐다면, 우리는 **탐지+자동 패치**로 그 다음 세대를 만든다.

### 1-3. 목표

- **사업 목표**: 첫 유료 고객 10사 확보 / 연간 반복 수익(ARR) 3억원 달성 (출시 후 12개월 내)
- **제품 목표**: 취약점 탐지 정확도 90% 이상 / 자동 패치 승인율 60% 이상
- **PoC 목표**: 3개월 내 GitHub 연동 데모 완성 / 외부 파일럿 고객 3사 확보

---

## 2. 문제 정의 (Problem Statement)

### 2-1. 타깃 사용자

| 구분 | 설명 | 주요 고통 |
|---|---|---|
| **Primary** | 개발팀 리드 / 시니어 개발자 | 보안팀 요청으로 취약점 수정하는데 시간이 너무 많이 걸림 |
| **Secondary** | 보안팀 / CISO | 오탐이 너무 많아 신뢰성 떨어지고, 개발팀과 마찰 잦음 |
| **Economic Buyer** | CTO / 기술임원 | 보안 인증(CSAP, ISO 27001 등) 준비에 비용이 과다하게 투입됨 |

### 2-2. 사용자 여정의 현재 고통

```
[현재 흐름]

1. SAST 툴 실행 → 500개 취약점 리포트 생성 (오탐 포함)
       ↓ (보안팀이 수동 분류, 1~2주 소요)
2. 개발팀에 수정 요청 티켓 전달
       ↓ (개발자, 어떻게 고쳐야 할지 모름)
3. 스택오버플로우 검색 or 보안 컨설턴트에게 문의
       ↓ (컨설턴트 스케줄 대기, 수일~수주)
4. 코드 수정 후 재검증
       ↓
5. 다음 릴리즈에야 반영
```

**결과**: 취약점 발견에서 패치 완료까지 평균 **60~90일** 소요. 그 사이 실제 침해 발생.

### 2-3. 우리가 해결하는 것

```
[목표 흐름]

1. PR 생성 / 코드 푸시 → 에이전트 자동 실행 (수분 내)
       ↓
2. 취약점 탐지 + 심각도 분류 + 오탐 필터링
       ↓
3. 취약점별 패치 코드 자동 생성 → PR로 제출
       ↓
4. 개발자는 PR 리뷰 후 승인 클릭만
```

**결과**: 취약점 발견에서 패치 PR 생성까지 **수분 내** 완료.

---

## 3. 제품 범위 (Scope)

### 3-1. In Scope (v1.0 기준)

- GitHub / GitLab / Bitbucket 저장소 연동
- SAST 방식 정적 코드 분석 (Python, JavaScript/TypeScript, Java, Go)
- 취약점 탐지 + 자동 패치 PR 생성
- CVE DB / OWASP Top 10 기준 취약점 분류
- PR / Merge 이벤트 기반 자동 실행 (CI/CD 트리거)
- 웹 대시보드: 취약점 현황 / 히스토리 / 리포트

### 3-2. Out of Scope (v1.0)

- DAST(동적 분석), IAST(런타임 분석)
- 의존성 패키지 취약점 분석 (SCA) — v2 검토
- C/C++, C#, Swift 등 추가 언어 — v2 검토
- 온프레미스 설치형 — 엔터프라이즈 플랜에서 별도 계약

---

## 4. 기능 요구사항 (Functional Requirements)

### 4-1. 핵심 기능

#### F-01. 저장소 연동 및 스캔 트리거

- GitHub App / GitLab Integration / Bitbucket App 형태로 설치
- 트리거 조건: PR 생성, 브랜치 푸시, 수동 실행, 스케줄 실행
- 연동 후 첫 실행 시 전체 코드베이스 초기 스캔 수행

#### F-02. 취약점 탐지 엔진

- **1차 탐지**: 룰 기반 AST 분석 (빠른 스캔, 명확한 패턴 탐지)
- **2차 분석**: LLM 기반 컨텍스트 이해 (룰 기반 오탐 필터링 + 복합 취약점 탐지)
- 심각도 분류: Critical / High / Medium / Low / Informational
- OWASP Top 10, CWE, CVE 기준 매핑 및 태그

탐지 대상 취약점 예시:

| 카테고리 | 세부 항목 |
|---|---|
| Injection | SQL Injection, Command Injection, LDAP Injection |
| XSS | Reflected, Stored, DOM-based |
| 인증/인가 | Hardcoded credentials, Insecure JWT, Broken Access Control |
| 암호화 | 약한 해시(MD5/SHA1), 하드코딩된 키, 안전하지 않은 랜덤 |
| 설정 오류 | Debug mode on, CORS 과도 허용, 민감 정보 로깅 |
| 의존성 | 알려진 취약 버전 사용 |

#### F-03. 자동 패치 PR 생성 (핵심 차별점)

- 탐지된 취약점별 LLM이 패치 코드 생성
- 기존 코드 스타일 / 네이밍 컨벤션 유지
- 패치 PR에 포함되는 내용:
  - 변경된 코드 diff
  - 취약점 설명 (왜 위험한가)
  - 패치 설명 (무엇을 어떻게 고쳤는가)
  - 참고 링크 (CVE, OWASP)
  - 테스트 코드 제안 (선택)
- 패치 불가능한 경우: 수동 수정 가이드 + 우선순위 제공

#### F-04. 오탐 관리

- 개발자가 "오탐"으로 마킹하면 패턴 학습 → 이후 동일 패턴 자동 제외
- 팀 단위 오탐 규칙 공유
- 오탐율 트래킹 대시보드

#### F-05. 대시보드 및 리포트

- 저장소별 / 팀별 보안 점수 (Security Score)
- 취약점 추이 그래프 (신규 발생 / 해결 / 미해결)
- CISO용 경영진 리포트 자동 생성 (PDF)
- 보안 인증 준비용 증적 자료 출력 (CSAP, ISO 27001 등)

### 4-2. 부가 기능

#### F-06. IDE 플러그인 (v1.1)

- VS Code 익스텐션: 코드 작성 중 실시간 취약점 하이라이팅
- 인라인 패치 제안

#### F-07. Slack / Teams 알림 연동

- 취약점 탐지 → 담당자 멘션
- 주간 보안 리포트 자동 발송

---

## 5. 비기능 요구사항 (Non-Functional Requirements)

| 항목 | 요구사항 |
|---|---|
| **스캔 속도** | 10만 라인 코드베이스 기준 5분 내 스캔 완료 |
| **패치 생성 속도** | 취약점 1건당 패치 PR 생성 30초 이내 |
| **정확도** | 탐지 정확도 90% 이상 / 오탐율 10% 이하 |
| **가용성** | SLA 99.5% uptime |
| **보안** | 코드 데이터 전송 시 TLS 암호화 / 고객 코드 학습에 미사용 명시 |
| **확장성** | 저장소 1,000개 동시 처리 가능 구조 |
| **규정 준수** | 고객 코드 저장 최소화 / 처리 후 삭제 옵션 제공 |

---

## 6. 기술 아키텍처 (Technical Architecture)

### 6-1. 전체 구조

```
[고객 저장소]
     │ Webhook (PR / Push 이벤트)
     ▼
[API Gateway]
     │
     ▼
[스캔 오케스트레이터]
     ├── 1차: 룰 기반 AST 분석 엔진 (Semgrep 기반)
     └── 2차: LLM 에이전트 (Claude API)
              ├── 컨텍스트 이해 + 오탐 필터
              └── 패치 코드 생성
                       │
                       ▼
               [패치 PR 자동 생성]
               [대시보드 DB 업데이트]
```

### 6-2. 기술 스택 (초안)

| 레이어 | 기술 |
|---|---|
| 1차 탐지 엔진 | Semgrep (오픈소스 룰 기반 SAST) |
| LLM | Claude API (claude-sonnet) |
| 백엔드 | Python (FastAPI) |
| 저장소 연동 | GitHub App API, GitLab API, Bitbucket API |
| 데이터베이스 | PostgreSQL (취약점 히스토리) + Redis (스캔 큐) |
| 프론트엔드 | Next.js |
| 인프라 | AWS (ECS Fargate) |
| 취약점 DB | NVD (CVE), OWASP, Semgrep 룰셋 |

### 6-3. 핵심 기술 의사결정

**왜 Semgrep + LLM 조합인가?**

Semgrep만으로는 컨텍스트를 모르는 오탐이 많다. LLM만으로는 속도가 느리고 비용이 크다. Semgrep이 빠르게 후보를 추려주고, LLM이 컨텍스트를 이해해 최종 판단 + 패치 생성을 담당하는 하이브리드 구조가 최적이다.

**코드 보안 처리 원칙**

- 고객 코드는 스캔 처리 후 즉시 삭제 (저장 안 함)
- LLM 학습 데이터로 사용하지 않음을 계약서에 명시
- 엔터프라이즈는 VPC 내 프라이빗 배포 옵션 제공

---

## 7. 수익 모델 (Business Model)

### 7-1. 플랜 구조

| 플랜 | 대상 | 가격 | 포함 내용 |
|---|---|---|---|
| **Starter** | 스타트업 / 개인팀 | 월 30만원 | 저장소 5개 / 개발자 10명 |
| **Growth** | 중소기업 | 월 100만원 | 저장소 20개 / 개발자 50명 |
| **Scale** | 성장 기업 | 월 300만원 | 저장소 무제한 / 개발자 200명 |
| **Enterprise** | 대기업 / 공공 | 별도 협의 | 온프레미스 + SLA + 전담 지원 |

> 비교: Veracode 최소 플랜 연 2,000만원 이상 → 우리 Growth 플랜 연 1,200만원

### 7-2. 수익 시나리오

| 시점 | 고객사 수 | MRR |
|---|---|---|
| 출시 3개월 | 10사 | 500만원 |
| 출시 6개월 | 30사 | 1,500만원 |
| 출시 12개월 | 80사 | 4,000만원 |

---

## 8. 경쟁 분석 (Competitive Analysis)

| | **우리** | Snyk | Veracode | Checkmarx | GitHub Advanced Security |
|---|---|---|---|---|---|
| 자동 패치 PR | ✅ 핵심 기능 | ❌ 없음 | ❌ 없음 | ❌ 없음 | 부분적 |
| 한국어 지원 | ✅ | ❌ | ❌ | ❌ | ❌ |
| 가격 | ★★★★★ | ★★★ | ★★ | ★★ | ★★★ |
| 오탐율 | 낮음 (LLM 필터) | 중간 | 높음 | 높음 | 중간 |
| 보안 인증 리포트 | ✅ CSAP 지원 | ❌ | ❌ | ❌ | ❌ |
| 설치 복잡도 | 낮음 | 낮음 | 높음 | 높음 | 낮음 |

**핵심 차별점 요약**
1. 탐지가 아닌 **패치까지** — 이것 하나만으로 기존 시장과 완전히 다른 가치 제안
2. **한국 시장 특화** — CSAP, ISMS 등 국내 인증 대응 리포트 자동 생성
3. **압도적 가격** — 기존 대비 1/5 수준

---

## 9. PoC 계획 (Proof of Concept)

### 9-1. 목표

3개월 내에 다음을 증명한다:
- GitHub 연동 → 취약점 탐지 → 패치 PR 생성 엔드투엔드 플로우 동작
- 실제 오픈소스 프로젝트 대상 탐지 정확도 측정
- 파일럿 고객 3사에서 실제 사용 후 피드백 수집

### 9-2. PoC 범위 (의도적으로 좁게)

- 언어: Python만
- 취약점: OWASP Top 10 중 SQL Injection, XSS, Hardcoded Credentials 3가지
- 저장소: GitHub만
- 패치: 자동 PR 생성 (리뷰 및 승인은 사람)

### 9-3. 단계별 일정

```
Week 1-2:  Semgrep 룰셋 구성 + Python AST 파이프라인 구축
Week 3-4:  Claude API 연동 → 오탐 필터 + 패치 코드 생성
Week 5-6:  GitHub App 연동 + 자동 PR 생성
Week 7-8:  내부 테스트 (오픈소스 취약 코드 벤치마크)
Week 9-10: 파일럿 고객 3사 온보딩
Week 11-12: 피드백 반영 + 1차 개선 + 데모 영상 제작
```

### 9-4. 성공 기준 (Go / No-Go)

| 기준 | 목표값 |
|---|---|
| 탐지 정확도 | 80% 이상 (PoC 기준 완화) |
| 패치 PR 승인율 | 40% 이상 |
| 파일럿 고객 NPS | 30 이상 |
| 유료 전환 의향 | 파일럿 3사 중 2사 이상 |

---

## 10. 리스크 및 대응

| 리스크 | 가능성 | 영향 | 대응 방안 |
|---|---|---|---|
| LLM이 잘못된 패치 생성 → 신뢰 손상 | 높음 | 높음 | 패치 PR은 항상 사람 리뷰 필수 / 자동 머지 없음 명시 |
| 고객 코드 유출 우려 | 중간 | 매우 높음 | 코드 즉시 삭제 정책 / SOC 2 인증 로드맵 수립 |
| GitHub Advanced Security 무료화 | 낮음 | 중간 | 패치 자동화 + 한국 인증 특화로 차별화 유지 |
| API 비용 과다 | 중간 | 중간 | 1차 룰 기반으로 LLM 호출 최소화 / 캐싱 전략 |
| 오탐율 높아 개발자 외면 | 중간 | 높음 | 오탐 피드백 루프 설계 / 초반엔 오탐 낮은 유형만 탐지 |

---

## 11. 미결 사항 (Open Questions)

- [ ] 코드 처리 시 데이터 레지던시 요구사항 (금융권은 국내 서버 필수 여부 확인 필요)
- [ ] Semgrep 오픈소스 룰셋 라이선스 확인 (상업적 이용 조건)
- [ ] 파일럿 고객 후보사 리스트 작성 (내부 네트워크 활용)
- [ ] 엔터프라이즈 온프레미스 배포 시 Claude API 사용 전략 (로컬 모델 병행 검토)
- [ ] 가격 민감도 검증 — Starter 월 30만원이 적정한지 파일럿에서 확인
- [ ] ISMS / CSAP 인증 리포트 포맷 사전 조사

---

*다음 단계: 파일럿 고객 후보 3사 리스트업 → 초기 미팅 진행 → PoC Week 1 착수*

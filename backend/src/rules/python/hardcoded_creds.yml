rules:
  # ---------------------------------------------------------------
  # CWE-798: Hardcoded Credentials (Python)
  # 소스 코드에 비밀번호, API 키, 시크릿 등을 하드코딩하는 패턴을 탐지한다.
  # ---------------------------------------------------------------

  - id: vulnix.python.hardcoded_creds.password_assignment
    languages: [python]
    severity: ERROR
    message: |
      Hardcoded Credentials 탐지: 소스 코드에 패스워드가 하드코딩되어 있습니다.
      환경변수 또는 시크릿 관리 서비스(AWS Secrets Manager, Vault 등)를 사용하세요.
    metadata:
      cwe: ["CWE-798", "CWE-259"]
      owasp: ["A07:2021 - Identification and Authentication Failures"]
      confidence: HIGH
      category: security
    patterns:
      - pattern: |
          password = "..."
      - pattern: |
          passwd = "..."
      - pattern: |
          pwd = "..."
      - pattern: |
          secret = "..."
    pattern-not-regex: '.*=\s*""\s*$'   # 빈 문자열은 제외

  - id: vulnix.python.hardcoded_creds.api_key
    languages: [python]
    severity: ERROR
    message: |
      Hardcoded Credentials 탐지: API 키가 소스 코드에 하드코딩되어 있습니다.
      환경변수(os.environ)를 사용하세요.
    metadata:
      cwe: ["CWE-798"]
      owasp: ["A07:2021 - Identification and Authentication Failures"]
      confidence: HIGH
      category: security
    patterns:
      - pattern: |
          api_key = "..."
      - pattern: |
          API_KEY = "..."
      - pattern: |
          apikey = "..."
    pattern-not-regex: 'os\.environ|os\.getenv|getenv'

  - id: vulnix.python.hardcoded_creds.aws_access_key
    languages: [python]
    severity: ERROR
    message: |
      Hardcoded Credentials 탐지: AWS Access Key가 소스 코드에 하드코딩되어 있습니다.
      AWS IAM Role 또는 환경변수를 사용하세요.
    metadata:
      cwe: ["CWE-798"]
      owasp: ["A07:2021 - Identification and Authentication Failures"]
      confidence: HIGH
      category: security
    pattern-regex: '(?:AKIA|ASIA|AROA|AIDA)[A-Z0-9]{16}'

  - id: vulnix.python.hardcoded_creds.db_connection_string
    languages: [python]
    severity: WARNING
    message: |
      Hardcoded Credentials 탐지: DB 연결 문자열에 패스워드가 포함되어 있습니다.
      환경변수 또는 시크릿 관리 서비스를 사용하세요.
    metadata:
      cwe: ["CWE-798"]
      owasp: ["A07:2021 - Identification and Authentication Failures"]
      confidence: MEDIUM
      category: security
    pattern-regex: '(?:postgresql|mysql|mongodb)://[^:]+:[^@]+@'

  - id: python-hardcoded-jwt-secret
    languages: [python]
    severity: ERROR
    message: JWT 서명 시크릿이 하드코딩됨. 환경변수로 관리 필요.
    metadata:
      cwe: ["CWE-798"]
      owasp: ["A02:2021 - Cryptographic Failures"]
    patterns:
      - pattern: jwt.encode($PAYLOAD, "$SECRET", ...)
      - pattern-not: jwt.encode($PAYLOAD, os.environ[...], ...)
      - pattern-not: jwt.encode($PAYLOAD, os.getenv(...), ...)

  - id: python-hardcoded-private-key
    languages: [python]
    severity: ERROR
    message: 하드코딩된 Private Key 감지. 환경변수 또는 시크릿 매니저 사용 필요.
    metadata:
      cwe: ["CWE-798"]
      owasp: ["A02:2021 - Cryptographic Failures"]
    pattern-regex: '-----BEGIN (RSA |EC )?PRIVATE KEY-----'

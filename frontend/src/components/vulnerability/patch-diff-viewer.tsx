/**
 * 패치 Diff 뷰어 컴포넌트
 * unified diff 형식 파싱 후 줄별 색상 강조
 * F-04 설계서 5-3절 기준:
 *   + 줄: bg-green-900/30 text-green-300
 *   - 줄: bg-red-900/30 text-red-300
 *   @@ 줄: text-blue-400
 *   나머지: text-gray-400
 */

interface PatchDiffViewerProps {
  /** unified diff 문자열 */
  diff: string;
}

/** 줄 타입별 스타일 반환 */
function getDiffLineStyle(line: string): string {
  if (line.startsWith('+') && !line.startsWith('+++')) {
    return 'bg-green-900/30 text-green-300';
  }
  if (line.startsWith('-') && !line.startsWith('---')) {
    return 'bg-red-900/30 text-red-300';
  }
  if (line.startsWith('@@')) {
    return 'text-blue-400';
  }
  if (line.startsWith('+++') || line.startsWith('---')) {
    return 'text-gray-500';
  }
  return 'text-gray-400';
}

export function PatchDiffViewer({ diff }: PatchDiffViewerProps) {
  const lines = diff.split('\n');

  return (
    <div className="bg-gray-950 rounded-lg border border-gray-800 overflow-x-auto">
      <pre className="text-sm font-mono">
        {lines.map((line, index) => (
          <div
            key={index}
            className={`px-4 py-0.5 whitespace-pre ${getDiffLineStyle(line)}`}
          >
            {line || ' '}
          </div>
        ))}
      </pre>
    </div>
  );
}

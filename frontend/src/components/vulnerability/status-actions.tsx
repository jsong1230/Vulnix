'use client';

import type { VulnerabilityStatus } from '@/lib/scan-api';

interface StatusActionsProps {
  vulnId: string;
  currentStatus: VulnerabilityStatus;
  /** 상태 변경 요청 핸들러 (뮤테이션 트리거) */
  onStatusChange: (newStatus: VulnerabilityStatus) => void;
  /** 뮤테이션 진행 중 여부 */
  isPending?: boolean;
}

/**
 * 취약점 상태 변경 액션 버튼 그룹
 * 현재 상태에 따라 가능한 액션만 노출:
 *   open -> false_positive, ignored, patched
 *   false_positive / ignored / patched -> open (재열기)
 */
export function StatusActions({
  currentStatus,
  onStatusChange,
  isPending = false,
}: StatusActionsProps) {
  const handleAction = (newStatus: VulnerabilityStatus, confirmMessage: string) => {
    if (window.confirm(confirmMessage)) {
      onStatusChange(newStatus);
    }
  };

  return (
    <div className="flex items-center gap-2 flex-wrap">
      {currentStatus === 'open' && (
        <>
          <button
            type="button"
            disabled={isPending}
            onClick={() =>
              handleAction(
                'false_positive',
                '정말 오탐으로 표시하시겠습니까?\n실제 위험이 없는 경우에만 선택하세요.',
              )
            }
            className="btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed"
          >
            오탐으로 표시
          </button>
          <button
            type="button"
            disabled={isPending}
            onClick={() =>
              handleAction('ignored', '이 취약점을 무시하시겠습니까?')
            }
            className="btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed"
          >
            무시
          </button>
          <button
            type="button"
            disabled={isPending}
            onClick={() =>
              handleAction('patched', '패치 완료로 처리하시겠습니까?')
            }
            className="btn-primary text-sm disabled:opacity-50 disabled:cursor-not-allowed"
          >
            패치 완료
          </button>
        </>
      )}
      {(currentStatus === 'false_positive' ||
        currentStatus === 'ignored' ||
        currentStatus === 'patched') && (
        <button
          type="button"
          disabled={isPending}
          onClick={() =>
            handleAction('open', '이 취약점을 다시 열기 상태로 변경하시겠습니까?')
          }
          className="btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed"
        >
          다시 열기
        </button>
      )}
      {isPending && (
        <span className="text-gray-500 text-xs">처리 중...</span>
      )}
    </div>
  );
}

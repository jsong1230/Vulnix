/**
 * 코드 스니펫 뷰어 컴포넌트
 * 줄 번호 표시 + 취약 라인 범위 배경 하이라이트
 * F-04 설계서 ADR-F04-004: pre + CSS 줄 번호 방식 사용
 */

interface CodeViewerProps {
  /** 표시할 코드 문자열 */
  codeSnippet: string;
  /** 코드 스니펫 첫 번째 줄의 실제 파일 내 줄 번호 */
  startLine: number;
  /** 하이라이트 시작 줄 번호 (파일 기준) */
  highlightStart: number;
  /** 하이라이트 끝 줄 번호 (파일 기준) */
  highlightEnd: number;
}

export function CodeViewer({
  codeSnippet,
  startLine,
  highlightStart,
  highlightEnd,
}: CodeViewerProps) {
  const lines = codeSnippet.split('\n');

  return (
    <div className="bg-gray-950 rounded-lg border border-gray-800 overflow-x-auto">
      <table className="w-full text-sm font-mono border-collapse">
        <tbody>
          {lines.map((line, index) => {
            const lineNumber = startLine + index;
            // 취약 라인 범위 여부 판단
            const isHighlighted =
              lineNumber >= highlightStart && lineNumber <= highlightEnd;

            return (
              <tr
                key={lineNumber}
                className={isHighlighted ? 'bg-yellow-900/20' : undefined}
              >
                {/* 줄 번호 컬럼 */}
                <td className="select-none text-right pr-4 pl-4 py-0.5 text-gray-600 border-r border-gray-800 w-12 min-w-[3rem]">
                  {lineNumber}
                </td>
                {/* 코드 컬럼 */}
                <td
                  className={`pl-4 pr-4 py-0.5 whitespace-pre ${
                    isHighlighted ? 'text-yellow-100' : 'text-gray-300'
                  }`}
                >
                  {line}
                </td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  );
}
